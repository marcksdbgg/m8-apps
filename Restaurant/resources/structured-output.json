{
  "type": "object",
  "properties": {
    "respuesta": {
      "type": "string",
      "description": "Texto en español amigable para el cliente, listo para enviar por WhatsApp."
    },
    "accion": {
      "type": "string",
      "description": "Acción que debe ejecutar el workflow de n8n.",
      "enum": [
        "NONE",
        "MOSTRAR_CARTA",
        "INFO_PEDIDO",
        "INFO_DELIVERY",
        "ORDEN_DESCONOCIDA",
        "EXPECT_LOCATION",
        "EXPECT_PAYMENT",
        "ORDEN_CONFIRMADA"
      ]
    },
    "pedido_parseado": {
      "type": "array",
      "description": "Lista de líneas de pedido interpretadas a partir del mensaje del cliente.",
      "items": {
        "type": "object",
        "properties": {
          "producto_id": {
            "type": "string",
            "description": "ID del producto según la carta, por ejemplo 'taco_res_pollo'."
          },
          "producto_nombre": {
            "type": "string",
            "description": "Nombre comercial del producto, por ejemplo 'Taco res + pollo'."
          },
          "categoria_id": {
            "type": "string",
            "description": "ID de la categoría en la carta, por ejemplo 'el_clasico' o 'los_atrevidos'."
          },
          "cantidad": {
            "type": "integer",
            "minimum": 1,
            "description": "Cantidad de unidades solicitadas de este producto/variante."
          },
          "variant_id": {
            "type": "string",
            "description": "ID de la variante exacta, por ejemplo 'taco_res_pollo__01_medium'."
          },
          "variant_label": {
            "type": "string",
            "description": "Etiqueta de la variante, por ejemplo '01 Medium', '02 Small' o 'Tamaño único'."
          },
          "size_code": {
            "type": "string",
            "description": "Código de tamaño según la carta, por ejemplo '01_medium', '02_small', 'unico'."
          },
          "precio_unitario": {
            "type": "number",
            "description": "Precio unitario en la moneda configurada para esa variante."
          },
          "subtotal": {
            "type": "number",
            "description": "Precio_unitario * cantidad."
          }
        },
        "required": [
          "producto_id",
          "cantidad",
          "variant_id",
          "size_code",
          "precio_unitario",
          "subtotal"
        ]
      }
    },
    "total": {
      "type": "number",
      "description": "Total del pedido sumando todos los subtotales."
    },
    "resumen_pedido": {
      "type": "string",
      "description": "Resumen en texto del pedido, línea por línea, listo para mostrar al cliente o staff."
    },
    "errores": {
      "type": "array",
      "description": "Mensajes de error o advertencia (por ejemplo, productos no encontrados o dudas de interpretación).",
      "items": {
        "type": "string"
      }
    }
  },
  "required": [
    "respuesta",
    "accion",
    "pedido_parseado",
    "total"
  ]
}
